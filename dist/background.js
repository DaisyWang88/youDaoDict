function initIcon(){1==Options.dict_enable[1]&&chrome.browserAction.setIcon({path:"icon_nodict.gif"})}function genTable(a,b,c,d){var e="";isContainKoera(a)&&(e="&le=ko"),isContainJapanese(a)&&(e="&le=jap");var f=a;(isContainChinese(f)||isContainJapanese(f)||isContainKoera(f))&&f.length>15&&(f=f.substring(0,10)+"..."),f.length>25&&(f=f.substring(0,15)+" ...");var g="";if(g=noBaseTrans&&noWebTrans?['<div id="yddContainer" align=left style="padding:0px 0px 0px 0px;">','<div id="yddTop" class="ydd-sp"><div id="yddTopBorderlr"><a href="http://dict.youdao.com/search?q=',encodeURIComponent(a),"&keyfrom=chrome.extension",e,'" title="查看完整释义" class="ydd-icon" style="padding:0px 0px 0px 0px;padding-top:17px;" target=_blank></a> <a href="http://dict.youdao.com/search?q=',encodeURIComponent(a),"&keyfrom=chrome.extension",e,'" target=_blank title="查看完整释义" id="yddKeyTitle">',f,'</a>&nbsp;<span style="font-weight:normal;font-size:10px;">',b,'</span><span style="float:right;font-weight:normal;font-size:10px"><a href="http://www.youdao.com/search?q=',encodeURIComponent(a),'&ue=utf8&keyfrom=chrome.extension" target=_blank>详细</a></span><a class="ydd-close">&times;</a></div></div>','    <div id="yddMiddle">'].join(""):['<div id="yddContainer" align=left style="padding:0px 0px 0px 0px;">','<div id="yddTop" class="ydd-sp"><div id="yddTopBorderlr"><a href="http://dict.youdao.com/search?q=',encodeURIComponent(a),"&keyfrom=chrome.extension",e,'" title="查看完整释义" class="ydd-icon" style="padding:0px 0px 0px 0px;padding-top:17px;" target=_blank></a> <a href="http://dict.youdao.com/search?q=',encodeURIComponent(a),"&keyfrom=chrome.extension",e,'" target=_blank title="查看完整释义" id="yddKeyTitle">',f,'</a>&nbsp;<span style="font-weight:normal;font-size:10px;">',b,'&nbsp;&nbsp;</span><span id="ydd-voice">',speach,'</span><span style="float:right;font-weight:normal;font-size:10px"><a href="http://dict.youdao.com/search?q=',encodeURIComponent(a),"&keyfrom=chrome.extension",e,'" target=_blank>详细</a></span><a class="ydd-close">&times;</a></div></div>','<div id="yddMiddle">'].join(""),0==noBaseTrans){var h=['<div class="ydd-trans-wrapper" style="display:block;padding:0px 0px 0px 0px" id="yddSimpleTrans">','      <div class="ydd-tabs"><span class="ydd-tab">基本翻译</span></div>',"      %s","</div>"].join("");h=sprintf(h,c),g+=h}if(0==noWebTrans){var i=[' <div class="ydd-trans-wrapper" style="display:block;padding:0px 0px 0px 0px">','  <div class="ydd-tabs"><span class="ydd-tab">网络释义</span></div>',"  %s","</div>"].join("");i=sprintf(i,d),g+=i}return noBaseTrans&&noWebTrans&&(g+='&nbsp;&nbsp;没有英汉互译结果<br/>&nbsp;&nbsp;<a href="http://www.youdao.com/search?q='+encodeURIComponent(a)+'&ue=utf8&keyfrom=chrome.extension" target=_blank>请尝试网页搜索</a>'),g+="</div></div>",res=g,noBaseTrans=!1,noWebTrans=!1,speach="",res}function translateXML(a){var b=a.getElementsByTagName("yodaodict")[0];if(""+b.getElementsByTagName("return-phrase")[0].childNodes[0]!="undefined")var c=b.getElementsByTagName("return-phrase")[0].childNodes[0].nodeValue;""+b.getElementsByTagName("dictcn-speach")[0]!="undefined"&&(speach=b.getElementsByTagName("dictcn-speach")[0].childNodes[0].nodeValue);var d="&le=";""+b.getElementsByTagName("lang")[0]!="undefined"&&(d+=b.getElementsByTagName("lang")[0].childNodes[0].nodeValue);var e="";if(""+b.getElementsByTagName("phonetic-symbol")[0]!="undefined"){if(""+b.getElementsByTagName("phonetic-symbol")[0].childNodes[0]!="undefined")var f=b.getElementsByTagName("phonetic-symbol")[0].childNodes[0].nodeValue;null!=f&&(e="&nbsp;["+f+"]")}""+b.getElementsByTagName("translation")[0]=="undefined"&&(noBaseTrans=!0),""+b.getElementsByTagName("web-translation")[0]=="undefined"&&(noWebTrans=!0);var g,h,i="",j="";if(0==noBaseTrans){""+b.getElementsByTagName("translation")[0].childNodes[0]!="undefined"?g=b.getElementsByTagName("translation"):noBaseTrans=!0;var k;for(k=0;k<g.length-1;k++)i+='<div class="ydd-trans-container ydd-padding010">'+g[k].getElementsByTagName("content")[0].childNodes[0].nodeValue+"</div>";i+='<div class="ydd-trans-container ydd-padding010">'+g[k].getElementsByTagName("content")[0].childNodes[0].nodeValue+"</div>"}if(0==noWebTrans){""+b.getElementsByTagName("web-translation")[0].childNodes[0]!="undefined"?h=b.getElementsByTagName("web-translation"):noWebTrans=!0;var k;for(k=0;k<h.length-1;k++)j+='<div class="ydd-trans-container ydd-padding010"><a href="http://dict.youdao.com/search?q='+encodeURIComponent(h[k].getElementsByTagName("key")[0].childNodes[0].nodeValue)+"&keyfrom=chrome.extension"+d+'" target=_blank>'+h[k].getElementsByTagName("key")[0].childNodes[0].nodeValue+":</a> ",j+=h[k].getElementsByTagName("trans")[0].getElementsByTagName("value")[0].childNodes[0].nodeValue+"<br /></div>";j+='<div class="ydd-trans-container ydd-padding010"><a href="http://dict.youdao.com/search?q='+encodeURIComponent(h[k].getElementsByTagName("key")[0].childNodes[0].nodeValue)+"&keyfrom=chrome.extension"+d+'" target=_blank>'+h[k].getElementsByTagName("key")[0].childNodes[0].nodeValue+":</a> ",j+=h[k].getElementsByTagName("trans")[0].getElementsByTagName("value")[0].childNodes[0].nodeValue+"</div>"}return genTable(c,e,i,j)}function translateTransXML(a){var b=a.indexOf("CDATA["),c=a.indexOf("]]"),d=a.substring(b+6,c),e=a.substring(c+2,a.length-1);b=e.indexOf("CDATA["),c=e.indexOf("]]");var f=e.substring(b+6,c);if(trans_str_tmp=f.trim(),input_str_tmp=d.trim(),(isContainChinese(input_str_tmp)||isContainJapanese(input_str_tmp)||isContainKoera(input_str_tmp))&&input_str_tmp.length>15?input_str_tmp=input_str_tmp.substring(0,8)+" ...":input_str_tmp.length>25&&(input_str_tmp=input_str_tmp.substring(0,15)+" ..."),trans_str_tmp==input_str_tmp)return null;var g='<div id="yddContainer" align=left style="padding:0px 0px 0px 0px;" >    <div id="yddTop" class="ydd-sp"><div id="yddTopBorderlr"><a href="http://fanyi.youdao.com/translate?i='+encodeURIComponent(d)+'&keyfrom=chrome" class="ydd-icon" style="padding:0px 0px 0px 0px;padding-top:17px;" target=_blank">有道词典</a><div style="font-weight:normal;display: inline;">'+input_str_tmp.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")+'</div><span style="float:right;font-weight:normal;font-size:10px"><a href="http://fanyi.youdao.com/translate?i='+encodeURIComponent(d)+'&smartresult=dict&keyfrom=chrome.extension" target=_blank>详细</a></span><a class="ydd-close">&times;</a></div></div>    <div id="yddMiddle">      <div class="ydd-trans-wrapper" id="yddSimpleTrans">        <div class="ydd-trans-container ydd-padding010">'+f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")+"</div>      	</div>   </div>  </div>";return g}function fetchWordOnline(a,b){var c="";isContainKoera(a)&&(c="&le=ko");var d=new XMLHttpRequest;d.onreadystatechange=function(a){if(4==d.readyState&&200==d.status){var c=translateXML(d.responseXML);null!=c&&b(c)}};var e="http://dict.youdao.com/fsearch?client=deskdict&keyfrom=chrome.extension&q="+encodeURIComponent(a)+"&pos=-1&doctype=xml&xmlVersion=3.2&dogVersion=1.0&vendor=unknown&appVer=3.1.17.4208&le=eng";d.open("GET",e,!0),d.send()}function fetchWord(a,b){if(isContainKoera(a))return void fetchWordOnline(a,b);var c=new XMLHttpRequest;_word=a,_callback=b,c.onreadystatechange=function(a){clearTimeout(_timer)};var d="http://127.0.0.1:8999/word="+a+"&";c.open("GET",d,!0),c.send(),_timer=setTimeout(handleTimeout,600)}function handleTimeout(){fetchWordOnline(_word,_callback)}function fetchTranslate(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(a){if(4==c.readyState&&200==c.status){var d=translateTransXML(c.responseText);null!=d&&b(d)}};var d="http://fanyi.youdao.com/translate?client=deskdict&keyfrom=chrome.extension&xmlVersion=1.1&dogVersion=1.0&ue=utf8&i="+encodeURIComponent(a)+"&doctype=xml";c.open("GET",d,!0),c.send()}function publishOptionChangeToTabs(){chrome.tabs.query({status:"complete"},function(a){a.length&&a.forEach(function(a){chrome.tabs.sendMessage(a.id,{optionChanged:Options},function(a){})})})}var ColorsChanged=!0;initIcon(),sprintfWrapper={init:function(){if("undefined"==typeof arguments)return null;if(arguments.length<1)return null;if("string"!=typeof arguments[0])return null;if("undefined"==typeof RegExp)return null;for(var a=arguments[0],b=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),c=new Array,d=new Array,e=0,f=0,g=0,h=0,i="",j=null;j=b.exec(a);)j[9]&&(e+=1),f=h,g=b.lastIndex-j[0].length,d[d.length]=a.substring(f,g),h=b.lastIndex,c[c.length]={match:j[0],left:j[3]?!0:!1,sign:j[4]||"",pad:j[5]||" ",min:j[6]||0,precision:j[8],code:j[9]||"%",negative:parseInt(arguments[e])<0?!0:!1,argument:String(arguments[e])};if(d[d.length]=a.substring(h),0==c.length)return a;if(arguments.length-1<e)return null;var j=null,k=null;for(k=0;k<c.length;k++)"%"==c[k].code?substitution="%":"b"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument)).toString(2)),substitution=sprintfWrapper.convert(c[k],!0)):"c"==c[k].code?(c[k].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(c[k].argument))))),substitution=sprintfWrapper.convert(c[k],!0)):"d"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument))),substitution=sprintfWrapper.convert(c[k])):"f"==c[k].code?(c[k].argument=String(Math.abs(parseFloat(c[k].argument)).toFixed(c[k].precision?c[k].precision:6)),substitution=sprintfWrapper.convert(c[k])):"o"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument)).toString(8)),substitution=sprintfWrapper.convert(c[k])):"s"==c[k].code?(c[k].argument=c[k].argument.substring(0,c[k].precision?c[k].precision:c[k].argument.length),substitution=sprintfWrapper.convert(c[k],!0)):"x"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument)).toString(16)),substitution=sprintfWrapper.convert(c[k])):"X"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument)).toString(16)),substitution=sprintfWrapper.convert(c[k]).toUpperCase()):substitution=c[k].match,i+=d[k],i+=substitution;return i+=d[k]},convert:function(a,b){b?a.sign="":a.sign=a.negative?"-":a.sign;var c=a.min-a.argument.length+1-a.sign.length,d=new Array(0>c?0:c).join(a.pad);return a.left?"0"==a.pad||b?a.sign+a.argument+d.replace(/0/g," "):a.sign+a.argument+d:"0"==a.pad||b?a.sign+d+a.argument:d+a.sign+a.argument}},sprintf=sprintfWrapper.init;var noBaseTrans=!1,noWebTrans=!1,speach="",_word,_callback,_timer;chrome.extension.onRequest.addListener(function(a,b,c){var d=a.action;switch(d){case"getOptions":1==ColorsChanged&&c({init:"globalPages",ChangeColors:"true",ColorOptions:Options});break;case"setOptions":Options=a.data,publishOptionChangeToTabs();break;case"dict":navigator.appVersion.indexOf("Win")>-1?fetchWordOnline(a.word,c):fetchWordOnline(a.word,c);break;case"translate":fetchTranslate(a.word,c)}});