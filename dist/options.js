function translateXML(a){var b="<strong>查询:</strong><br/>",c=a.getElementsByTagName("yodaodict")[0],d=c.getElementsByTagName("return-phrase");""+d[0].childNodes[0]!="undefined"&&(retphrase=d[0].childNodes[0].nodeValue),""+c.getElementsByTagName("lang")[0]!="undefined"&&(langType=c.getElementsByTagName("lang")[0].childNodes[0].nodeValue);var e="",f=c.getElementsByTagName("phonetic-symbol")[0];if(""+f!="undefined"&&""+f.childNodes[0]!="undefined"){var g=f.childNodes[0].nodeValue;null!==g&&(e="&nbsp;["+g+"]")}var h=c.getElementsByTagName("translation")[0];if(""+h=="undefined"&&(noBaseTrans=!0),""+c.getElementsByTagName("web-translation")[0]=="undefined"&&(noWebTrans=!0),noBaseTrans===!1)if(b+=retphrase+"<br/><br/><strong>基本释义:</strong><br/>",""+h.childNodes[0]!="undefined")for(var i=c.getElementsByTagName("translation"),j=0;j<i.length;j++){var k=i[j].getElementsByTagName("content")[0].childNodes[0].nodeValue+"<br/>";if(k.length>50){var l=/[;；]/,m=k.split(l);k="";for(var n=0;n<m.length;n++)k+=m[n]+"<br/>"}basetrans+=k}else basetrans+="未找到基本释义";if(noWebTrans===!1){if(""+c.getElementsByTagName("web-translation")[0].childNodes[0]!="undefined")var o=c.getElementsByTagName("web-translation");else webtrans+="未找到网络释义";for(var j=0;j<o.length;j++)webtrans+=o[j].getElementsByTagName("key")[0].childNodes[0].nodeValue+":  ",webtrans+=o[j].getElementsByTagName("trans")[0].getElementsByTagName("value")[0].childNodes[0].nodeValue+"<br/>"}buildSearchResult()}function mainQuery(a,b){if(""!==a){var c=new XMLHttpRequest;if(c.onreadystatechange=function(a){if(4==c.readyState&&200==c.status){var d=translateXML(c.responseXML);null!=d&&b(d)}},_word=a.trim(),""!==_word){var d="http://dict.youdao.com/fsearch?client=deskdict&keyfrom=chrome.extension.g8up&q="+encodeURIComponent(a)+"&pos=-1&doctype=xml&xmlVersion=3.2&dogVersion=1.0&vendor=g8up&appVer=3.1.17.4208&le=eng";c.open("GET",d,!0),c.send()}}}function buildSearchResult(){document.querySelector("#options").style.display="none";var a="";isContainKoera(_word)&&(a="&le=ko"),isContainJapanese(_word)&&(a="&le=jap"),"fr"==langType&&(a="&le=fr");var b=document.getElementById("result");b.innerHTML="",0==noBaseTrans&&(basetrans="ko"==langType?"<strong>韩汉翻译:</strong><br/>"+basetrans:"jap"==langType?"<strong>日汉翻译:</strong><br/>"+basetrans:"fr"==langType?"<strong>法汉翻译:</strong><br/>"+basetrans:"<strong>英汉翻译:</strong><br/>"+basetrans,b.innerHTML=basetrans),0==noWebTrans&&(webtrans="<strong>网络释义:</strong><br/>"+webtrans,b.innerHTML+=webtrans),(0==noBaseTrans||0==noWebTrans)&&(b.innerHTML+="<a href ='http://dict.youdao.com/search?q="+encodeURIComponent(_word)+"&ue=utf8&keyfrom=chrome.extension"+a+"' target=_blank>点击 查看详细释义</a>"),noBaseTrans&&noWebTrans?(b.innerHTML="未找到英汉翻译!",b.innerHTML+="<br><a href ='http://www.youdao.com/search?q="+encodeURIComponent(_word)+"&ue=utf8&keyfrom=chrome.extension' target=_blank>尝试用有道搜索</a>"):saveSearchedWord(),getCachedWord(),retphrase="",webtrans="",basetrans="",_word="",langType="",noBaseTrans=!1,noWebTrans=!1}function getCachedWord(){var a=[],b=localStorage.getItem("wordcache");if(b&&(b=b.trim())){for(var c=Options.history_count>=0?Options.history_count:0,d=b.split(",",c),e=0,f=d.length;f>e;e++)a.push("<a>"+d[e]+"</a>");if(a.length){var b=document.querySelector("#cache");a.unshift("<strong>查询历史：</strong>"),b.innerHTML=a.join("<br/>"),b.onclick=function(a){var b=a||window.event,c=b.target;if("a"==c.tagName.toLowerCase()){var d=c.innerText;d&&(document.querySelector("#word").value=d,mainQuery(d,translateXML))}},b=null}}}function saveSearchedWord(a){var b=a||(document.querySelector("#word")?document.querySelector("#word").value:"");if(b&&(b=b.trim())){var c=localStorage.getItem("wordcache");if(c){if(c.indexOf(b)>-1)return;c=[b,c].join()}else c=b;localStorage.setItem("wordcache",c)}}function changeIcon(){var a=document.getElementById("english_only"),b=document.getElementById("dict_enable"),c=b.checked;a.disabled=!c,chrome.browserAction.setIcon({path:c?"icon-yd-dict.png":"icon_nodict.gif"})}function check(){var a=document.getElementsByName("word")[0].value;window.open("http://dict.youdao.com/search?q="+encodeURI(a)+"&ue=utf8&keyfrom=chrome.index.g8up")}function restoreOptions(){for(key in Options){var a=document.getElementById(key);if(a){var b=Options[key];if(!b)continue;var c=a.getAttribute("type");switch(c){case"checkbox":"checked"==b[0]&&(a.checked=b[1]);break;case"number":a.value=b||Options.history_count}}}}function exportHistory(){var a=localStorage.getItem("wordcache");if(a){var b=chrome.app.getDetails(),c=b.name,d=b.version,e=["【"+c+"】Ver"+d+" 查询历史备份文件",(new Date).toString().slice(0,24),new Array(25).join("=")].join("\r\n"),f=e+"\r\n"+a.replace(/\,/g,"\r\n");saveContent2File(f,"youDaoCrx-history-"+ +new Date+".txt")}}function saveContent2File(a,b){var c=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(c,b)}function saveOptions(){for(key in Options){var a=document.getElementById(key);"checked"==Options[key][0]?Options[key][1]=a.checked:Options[key]=a.value}localStorage.ColorOptions=JSON.stringify(Options),chrome.extension.sendRequest({action:"setOptions",data:Options},function(a){})}var retphrase="",basetrans="",webtrans="",noBaseTrans=!1,noWebTrans=!1,langType="",_word;document.body.onload=function(){var a=document.getElementById("word");a&&a.focus(),restoreOptions(),changeIcon(),getCachedWord()};var optElem=document.querySelector("#options");optElem&&(optElem.onmouseover=function(){document.querySelector("table",this).style.display="block",this.onmouseover=null,document.getElementById("dict_enable").onclick=function(){saveOptions(),changeIcon()},document.getElementById("ctrl_only").onclick=function(){saveOptions()},document.getElementById("english_only").onclick=function(){saveOptions()},document.getElementById("history_count").onclick=document.getElementById("history_count").onkeyup=function(){saveOptions(),getCachedWord()}}),document.getElementById("word").onkeydown=function(){13==event.keyCode&&mainQuery(document.getElementsByName("word")[0].value,translateXML)},document.getElementById("querybutton").onclick=function(){mainQuery(document.getElementsByName("word")[0].value,translateXML)},document.querySelector("#backup").onclick=function(){exportHistory()};